{% extends "base.html" %}

{% block content %}
    <div class="box">
        <h2>Senti-O-Meter</h2>
        <form id="submitForm" action="/submit" method="POST">
            {{ review_form.csrf_token }}
            <label for="review">{{ review_form.review.label }}</label>
            {{ review_form.review(class="review-input") }}

            <p>Please review our service:</p>
            <p>1 Star - Very Dissatisfied, 5 Stars - Very Satisfied</p>
            <div id="starRating" class="rating">
                <div class="stars">
                    <input type="radio" id="star1" name="rating" value="5" required>
                    <label for="star1"></label>

                    <input type="radio" id="star2" name="rating" value="4" required>
                    <label for="star2"></label>

                    <input type="radio" id="star3" name="rating" value="3" required>
                    <label for="star3"></label>

                    <input type="radio" id="star4" name="rating" value="2" required>
                    <label for="star4"></label>

                    <input type="radio" id="star5" name="rating" value="1" required>
                    <label for="star5"></label>
                </div>
            </div>


            <input type="hidden" id="ratingValue" name="rating" value=""> <!-- Updated name to 'rating' -->

            <input type="submit" onclick="disableSubmitButton()">
        </form>

        <script>
            var stars = document.querySelectorAll('.rating input[type="radio"]');
            var submitButton = document.querySelector('input[type="submit"]');
            var ratingValueInput = document.getElementById('ratingValue');
            var reviewInput = document.getElementById('review');

            function handleRating(event) {
                var selectedRating = event.target.value;
                ratingValueInput.value = selectedRating;  // Update the ratingValue with the selected rating
            }

            function disableSubmitButton() {
                if (ratingValueInput.value === "" || reviewInput.value.trim() === "") {
                    event.preventDefault();  // Prevent form submission
                    alert("Please select a star rating and provide a review.");
                } else {
                    submitButton.disabled = true;
                    submitButton.value = 'Submitting...';
                    document.getElementById('submitForm').submit();
                }
            }

            // Add event listener to each star rating input
            for (var i = 0; i < stars.length; i++) {
                stars[i].addEventListener('change', handleRating);
            }
        </script>


        <div class="item">
            <h2>{{ smiley_emoji | safe }}</h2>
        </div>

        <div class="item">
            <h2>{{ current_version }}</h2>
        </div>
    </div>
{% endblock %}
